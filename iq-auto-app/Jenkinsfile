
pipeline {
    agent any

    environment {
		IQ_ORGANISATION_ID = 'unknown'
		IQ_ORGANISATION_INFO_FILE = './organisation.json'
    }

    stages {
        stage('Preparation') {
			steps {
				echo "Hello from Nexus-IQ pipeline"
				echo "${IQ_ORGANISATION}"
				echo "${IQ_APPLICATION}"
			}
		}
		
		stage('Create Nexus IQ Organisation'){
			steps {
				script {
					try {
                        def response = sh returnStdout: true, script: "curl -u admin:admin123 -X POST -o ${IQ_ORGANISATION_INFO_FILE} -H 'Content-Type: application/json' -d '{\"name\": \"${IQ_ORGANISATION}\"}' http://localhost:8070/api/v2/organizations"
						echo "${response}"
						echo "---- org info ----"
						sh "cat ${IQ_ORGANISATION_INFO_FILE}"
                    }
                    catch (error) {
                        throw error
                    }
				}
			}
		}

		// stage('Create Nexus IQ Application'){
		// 	steps {
		// 		script {
		// 			try {
        //                 def response = sh returnStdout: true, script: "curl -u admin:admin123 -X POST -H 'Content-Type: application/json' -d '{\"publicId\": \"${IQ_APPLICATION}\",\"name\": \"${IQ_APPLICATION}\",\"organizationId\":\"${IQ_ORGANISATION_ID}\"}' http://localhost:8070/api/v2/applications"
		// 				echo "${response}"
        //             }
        //             catch (error) {
        //                 throw error
        //             }
		// 		}
		// 	}
		// }
	}
}


